<!DOCTYPE html>
<html>
<head>
	<title>natural selection</title>
	<canvas id="canvas" style="border:1px solid #000000;"></canvas>
	<script src="../geometry.js"></script>
	<script src="../Vectors.js"></script>
</head>
<body>


<!-- Builds the map -->
<script src="canvas.js"></script>


<!-- Draws the creatures -->
<script src="creatures.js"></script>
<script src="food.js"></script>

<!-- Manage epochs. An "epoch" is a round -->
<script src="epoch.js"></script>

<script>

let creatures = []
for (let x = 50; x < canvas.width; x+= 100) {
	// creatures.push(new Creature(new Vector(x, 50), (new Vector(x, 50)).directionTowards(canvas.width/2, canvas.height/2) ))
	creatures.push(new Creature(new Vector(x, 50), new Vector(0, 1) ) )
	creatures.push(new Creature(new Vector(x, canvas.height - 50), new Vector(0, -1) ) )
}

// creatures.push(new Creature(new Vector(50, 50), new Vector(0, 1) ) )
// creatures.push(new Creature(new Vector(canvas.width, 50), new Vector(0, 1) ) )
console.log(creatures.length)

foodArray = generateFood(100)

epochArray = [new Epoch(creatures, foodArray)]

const GAMESPEED = 2


function run() {
	epoch = epochArray[epochArray.length - 1]
	wipeScreen();
	const uneatenFood = epoch.food.filter(food => !food.eaten)
	const aliveCreatures = epoch.creatures.filter(creature => creature.energy > 0)
	if (aliveCreatures.length == 0) {
		nextEpoch(epoch, epochArray)
	}

	aliveCreatures.forEach(creature => {
		creature.draw();
		// creature.drawSense();
		// creature.drawEnergy();
		creature.drawSpeed();
		creature.drawFoodEaten();
		creature.detectFood(uneatenFood);
		creature.move();
	})

	epoch.food.forEach(food => {
		if ( !food.eaten) {
			food.draw()
		} 
	})
	requestAnimationFrame(run);
}

run();
</script>